#!/usr/bin/env coffee
# vim:ft=coffee
# -*- mode:coffee -*-

convertChapter = (str) ->
    str.replace /^\[chapter:(.+)\]$/igm, (f, h) ->
        "［＃２字下げ］#{h}［＃「#{h}」は大見出し］"

convertRuby = (str) ->
    str.replace /\[\[rb:([^ \[\]]+) > ([^ \[\]]+)\]\]/ig, (f, b, t) ->
        "｜#{b}《#{t}》"

convertNewpage = (str) ->
    (str.split "[newpage]").join "［＃改ページ］"

main = () ->
    input = (require "fs").readFileSync "/dev/stdin", "utf-8"
    process.stdout.write convertRuby convertChapter convertNewpage input

main()
